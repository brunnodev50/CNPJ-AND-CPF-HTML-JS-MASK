
<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Validador CPF/CNPJ - Bootstrap</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { background-color: #f8f9fa; padding-top: 50px; }
        .card { border-radius: 15px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
    </style>
</head>
<body>

<div class="container">
    <div class="row justify-content-center">
        <div class="col-md-6">
            <div class="card p-4">
                <h3 class="mb-4 text-center">Cadastro de Documento</h3>
                
                <div class="mb-3">
                    <label for="doc" class="form-label">Digite CPF ou CNPJ</label>
                    <input type="text" id="doc" class="form-control form-control-lg" 
                           placeholder="000.000.000-00" maxlength="18" autocomplete="off">
                    <div id="feedback" class="form-text"></div>
                </div>

                <button class="btn btn-primary w-100" onclick="validarFormulario()">Validar Agora</button>
            </div>
        </div>
    </div>
</div>

<script>
    const inputDoc = document.getElementById('doc');
    const feedback = document.getElementById('feedback');

    // 1. MÁSCARA DINÂMICA
    inputDoc.addEventListener('input', (e) => {
        let value = e.target.value.replace(/\D/g, "");
        
        if (value.length <= 11) {
            value = value.replace(/(\d{3})(\d)/, "$1.$2")
                         .replace(/(\d{3})(\d)/, "$1.$2")
                         .replace(/(\d{3})(\d{1,2})$/, "$1-$2");
        } else {
            value = value.replace(/^(\d{2})(\d)/, "$1.$2")
                         .replace(/^(\d{2})\.(\d{3})(\d)/, "$1.$2.$3")
                         .replace(/\.(\d{3})(\d)/, ".$1/$2")
                         .replace(/(\d{4})(\d)/, "$1-$2");
        }
        e.target.value = value;
        
        // Limpa validação visual ao digitar
        inputDoc.classList.remove('is-valid', 'is-invalid');
        feedback.innerText = "";
    });

    // 2. LÓGICA DE VALIDAÇÃO
    function validarDocumento(doc) {
        doc = doc.replace(/\D/g, "");
        if (doc.length === 11) return validarCPF(doc);
        if (doc.length === 14) return validarCNPJ(doc);
        return false;
    }

    function validarCPF(cpf) {
        if (/^(\d)\1+$/.test(cpf)) return false;
        let soma = 0, resto;
        for (let i = 1; i <= 9; i++) soma += parseInt(cpf.substring(i-1, i)) * (11 - i);
        resto = (soma * 10) % 11;
        if ((resto === 10) || (resto === 11)) resto = 0;
        if (resto !== parseInt(cpf.substring(9, 10))) return false;
        soma = 0;
        for (let i = 1; i <= 10; i++) soma += parseInt(cpf.substring(i-1, i)) * (12 - i);
        resto = (soma * 10) % 11;
        if ((resto === 10) || (resto === 11)) resto = 0;
        return resto === parseInt(cpf.substring(10, 11));
    }

    function validarCNPJ(cnpj) {
        if (/^(\d)\1+$/.test(cnpj)) return false;
        let tamanho = cnpj.length - 2;
        let numeros = cnpj.substring(0, tamanho);
        let digitos = cnpj.substring(tamanho);
        let soma = 0;
        let pos = tamanho - 7;
        for (let i = tamanho; i >= 1; i--) {
            soma += numeros.charAt(tamanho - i) * pos--;
            if (pos < 2) pos = 9;
        }
        let resultado = soma % 11 < 2 ? 0 : 11 - (soma % 11);
        if (resultado != digitos.charAt(0)) return false;
        tamanho = tamanho + 1;
        numeros = cnpj.substring(0, tamanho);
        soma = 0;
        pos = tamanho - 7;
        for (let i = tamanho; i >= 1; i--) {
            soma += numeros.charAt(tamanho - i) * pos--;
            if (pos < 2) pos = 9;
        }
        resultado = soma % 11 < 2 ? 0 : 11 - (soma % 11);
        return resultado == digitos.charAt(1);
    }

    function validarFormulario() {
        const valor = inputDoc.value;
        const eValido = validarDocumento(valor);

        if (eValido) {
            inputDoc.classList.remove('is-invalid');
            inputDoc.classList.add('is-valid');
            feedback.innerText = "Documento válido!";
            feedback.className = "form-text text-success";
        } else {
            inputDoc.classList.remove('is-valid');
            inputDoc.classList.add('is-invalid');
            feedback.innerText = "Documento inválido. Verifique os números.";
            feedback.className = "form-text text-danger";
        }
    }
</script>

</body>
</html>
